Top Secret - 400 Points
=========================
The site for this challenge is a secret keeping service and the task was to get the admin's secret. There really isn't that much functionality to the site to abuse, so the only things to test out initially are SQL injection on the login form, the sign up form and the find friends search field. The login and sign up forms are not vulnerable to SQL injections, but the friends search is. If you just enter a ' then you get a SQL error along with the actual SQL query that was run. Using this it is possible to poke around and find some good information. However this can be hard without knowing anything about the database. It isn't impossible, but it's nice to know what tables and fields there are before doing the SQL injection. By doing some poking around, you can find a file called deploy.sh in /js on the site. This file seems to be what was used to setup the site and the database. But a couple lines that should delete some files are commented out. One of them is create\_db.sql, so browsing to /create\_db.sql will show you the structure for the MySQL database that is being used. With this you can see the secrets database so it would be wise to try and dump that from this SQL injection we found, but it does not work, cuz that would just be too easy! But one interesting thing is that there is a field for session, which is not very common in secure web apps. What can also be noticed is that everytime you login and logout of the site you have the same PHPSESSID as your cookie, so it would make sense to assume that this session field holds that PHPSESSID for your user when you login. So to actually get all of the session IDs from the friends form, you could enter the following string:

' UNION SELECT id,session from users #

This would show all ids and sessions for all users signed up. When seeing this data you would see your session id which should match your PHPSESSID cookie, alerting you that maybe every user really just has one session ID for everytime they login. So to login as admin and read his secrets, all you have to do is login like normal, then intercept the request for the home page and change the cookie value for PHPSESSID to be the session dumped from the database for the admin user. This should authenticate you as the admin and you should be able to read his secrets and potentially even add secrets of your own to his account! The flag was his first secret.

Another thing that was a slight hint to the whole session thing was flag.txt. The deploy.sh script alluded to this file, so if you checked to see if it existed, it did. It told you to go to the logout.php page and wait 15 seconds for some special portal. If you went there and waited this long you were redirected to instantcena.com and no special portal ever showed up. But you may have noticed that the message in flag.txt was a little weird and had some random words capitalized. Well if you took the capital letters in order they spelled SESSION. This was supposed to be a subtle hint that you need to get the session id for a user in order to login as them and see their secrets.

Flag: **RC3-SECRETSS-6277598130**
